<!-- include footer -->
<%- include('include/_header.ejs') %>
<!-- /include footer -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<link rel="icon" type="image/x-icon" href="images/fav.png">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
  <!-- MDB -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.2/mdb.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.2/mdb.min.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<style>
    body{
background:#eee;
}

.card {
box-shadow: 0 20px 27px 0 rgb(0 0 0 / 5%);
}

.card {
position: relative;
display: flex;
flex-direction: column;
min-width: 0;
word-wrap: break-word;
background-color: #fff;
background-clip: border-box;
border: 0 solid rgba(0,0,0,.125);
border-radius: 1rem;
}

.card-body {
-webkit-b-flex: 1;
-ms-flex: 1 1 auto;
flex: 1 1 auto;
padding: 1.5rem 1.5rem;
}
#cod{
  display: none;
}
#wallet{
  display: none;
}
.cc{
  display: none;
}
</style>
</head>
<body>


<div class="container">
<h1 class="h3 mb-9 mt-2">Payment</h1>
<div class="row">
  <% var cpn=coupon%>
  <% var Status=status||true%>
  <!-- Left -->
  <div class="col-lg-9">
    <div class="accordion" id="accordionPayment">
      <!-- Credit card -->
      <div class="accordion-item mb-3">
        <h2 class="h5 px-4 py-3 accordion-header d-flex justify-content-between align-items-center">
          <div class="form-check w-100 collapsed" data-bs-toggle="collapse" data-bs-target="#collapseCC" aria-expanded="false">
            <input type="radio" name="paymentOption" id="cod-btn" value="cashOnDelivery">
            <label class="form-check-label pt-1" for="payment1">

              Cash On Delivery
            </label>
          </div>
          <span>
            <svg width="34" height="25" xmlns="http://www.w3.org/2000/svg">
              <g fill-rule="nonzero" fill="#333840">
                <path d="M29.418 2.083c1.16 0 2.101.933 2.101 2.084v16.666c0 1.15-.94 2.084-2.1 2.084H4.202A2.092 2.092 0 0 1 2.1 20.833V4.167c0-1.15.941-2.084 2.102-2.084h25.215ZM4.203 0C1.882 0 0 1.865 0 4.167v16.666C0 23.135 1.882 25 4.203 25h25.215c2.321 0 4.203-1.865 4.203-4.167V4.167C33.62 1.865 31.739 0 29.418 0H4.203Z"></path>
                <path d="M4.203 7.292c0-.576.47-1.042 1.05-1.042h4.203c.58 0 1.05.466 1.05 1.042v2.083c0 .575-.47 1.042-1.05 1.042H5.253c-.58 0-1.05-.467-1.05-1.042V7.292Zm0 6.25c0-.576.47-1.042 1.05-1.042H15.76c.58 0 1.05.466 1.05 1.042 0 .575-.47 1.041-1.05 1.041H5.253c-.58 0-1.05-.466-1.05-1.041Zm0 4.166c0-.575.47-1.041 1.05-1.041h2.102c.58 0 1.05.466 1.05 1.041 0 .576-.47 1.042-1.05 1.042H5.253c-.58 0-1.05-.466-1.05-1.042Zm6.303 0c0-.575.47-1.041 1.051-1.041h2.101c.58 0 1.051.466 1.051 1.041 0 .576-.47 1.042-1.05 1.042h-2.102c-.58 0-1.05-.466-1.05-1.042Zm6.304 0c0-.575.47-1.041 1.051-1.041h2.101c.58 0 1.05.466 1.05 1.041 0 .576-.47 1.042-1.05 1.042h-2.101c-.58 0-1.05-.466-1.05-1.042Zm6.304 0c0-.575.47-1.041 1.05-1.041h2.102c.58 0 1.05.466 1.05 1.041 0 .576-.47 1.042-1.05 1.042h-2.101c-.58 0-1.05-.466-1.05-1.042Z"></path>
              </g>
            </svg>
          </span>
        </h2>
        <div id="cod" class="accordion-collapse collapse show" data-bs-parent="#accordionPayment" >
          <% if(price<100000){ %>
          <a href="/api/order?payment=COD" data-toggle="modal" data-target="#orderSuccessModal">
            <button class="btn btn-primary w-100 mt-2">Place order</button>
          </a>
        <% }else{ %>
          <p style="color: red; width: 100%;text-align: center;">Amound exeeds the limit</p>
        <% } %>
        </div>
      </div>

      <div class="accordion-item mb-3">
        <h2 class="h5 px-4 py-3 accordion-header d-flex justify-content-between align-items-center">
          <div class="form-check w-100 collapsed" data-bs-toggle="collapse" data-bs-target="#collapseCC" aria-expanded="false">
            <input type="radio" name="paymentOption" id="wallet-btn" value="cashOnDelivery">
            <label class="form-check-label pt-1" for="payment1">
              Wallet
            </label>

          </div>
          <span>
            wallet:<%= wallet %>
            
          </span>
        </h2>
        <div id="wallet" class="accordion-collapse collapse show" data-bs-parent="#accordionPayment" >
          <% if(price<=wallet){ %>
          <a href="/api/order?payment=wallet">
            <button class="btn btn-primary w-100 mt-2">Place order</button>
          </a>
          <% }else{ %>
            <% if(price-cpn>wallet){ %>
              <p style="color: red; width: 100%;text-align: center;">Insufficient balance</p>
              <% }else{ %>
                <p style="color: red; width: 100%;text-align: center;">Amound exeeds the limit</p>
                <% } %>
          <% } %>
        </div>
      </div>
      <div class="accordion-item mb-3">
        <h2 class="h5 px-4 py-3 accordion-header d-flex justify-content-between align-items-center">
          <div class="form-check w-100 collapsed" data-bs-toggle="collapse" data-bs-target="#collapseCC" aria-expanded="false">
            <input type="radio" name="paymentOption" id="cc-btn" value="cashOnDelivery">
            <label class="form-check-label pt-1" for="payment1">
              Online Payment
            </label>
          </div>
          <span>
            <svg width="34" height="25" xmlns="http://www.w3.org/2000/svg">
              <g fill-rule="nonzero" fill="#333840">
                <path d="M29.418 2.083c1.16 0 2.101.933 2.101 2.084v16.666c0 1.15-.94 2.084-2.1 2.084H4.202A2.092 2.092 0 0 1 2.1 20.833V4.167c0-1.15.941-2.084 2.102-2.084h25.215ZM4.203 0C1.882 0 0 1.865 0 4.167v16.666C0 23.135 1.882 25 4.203 25h25.215c2.321 0 4.203-1.865 4.203-4.167V4.167C33.62 1.865 31.739 0 29.418 0H4.203Z"></path>
                <path d="M4.203 7.292c0-.576.47-1.042 1.05-1.042h4.203c.58 0 1.05.466 1.05 1.042v2.083c0 .575-.47 1.042-1.05 1.042H5.253c-.58 0-1.05-.467-1.05-1.042V7.292Zm0 6.25c0-.576.47-1.042 1.05-1.042H15.76c.58 0 1.05.466 1.05 1.042 0 .575-.47 1.041-1.05 1.041H5.253c-.58 0-1.05-.466-1.05-1.041Zm0 4.166c0-.575.47-1.041 1.05-1.041h2.102c.58 0 1.05.466 1.05 1.041 0 .576-.47 1.042-1.05 1.042H5.253c-.58 0-1.05-.466-1.05-1.042Zm6.303 0c0-.575.47-1.041 1.051-1.041h2.101c.58 0 1.051.466 1.051 1.041 0 .576-.47 1.042-1.05 1.042h-2.102c-.58 0-1.05-.466-1.05-1.042Zm6.304 0c0-.575.47-1.041 1.051-1.041h2.101c.58 0 1.05.466 1.05 1.041 0 .576-.47 1.042-1.05 1.042h-2.101c-.58 0-1.05-.466-1.05-1.042Zm6.304 0c0-.575.47-1.041 1.05-1.041h2.102c.58 0 1.05.466 1.05 1.041 0 .576-.47 1.042-1.05 1.042h-2.101c-.58 0-1.05-.466-1.05-1.042Z"></path>
              </g>
            </svg>
          </span>
        </h2>
        <form id="checkout-form" class="cc">
          <button type="submit" class="btn btn-primary w-100 mt-2">Place order</button>
        </form>
        
      </div>
      
      <!-- PayPal -->
      
    </div>
  </div>
  <!-- Right -->
  <div class="col-lg-3">
    <div class="card position-sticky top-0">
      <div class="p-3 bg-light bg-opacity-10">
        <h6 class="card-title mb-3">Order Summary</h6>
        <div class="d-flex justify-content-between mb-1 small">
          <span>Subtotal</span> <span>₹ <%=price+parseInt(cpn)%></span>
        </div>
        <div class="d-flex justify-content-between mb-1 small">
          <span>Shipping</span> <span style="color: green;">Free</span>
        </div>
        <div class="d-flex justify-content-between mb-1 small">
          <span>Coupon</span> <span class="text-danger">-₹ <%= cpn %></span>
          <% if(cpn!='0'){ %>
            <a href="/api/removecoupon">
              <i class="fas fa-trash"></i>
            </a>
            
            <% } %>
        </div>

        <hr>
        <div class="d-flex justify-content-between mb-4 small">
          <span>TOTAL</span> <strong class="text-dark">₹ <%=price%></strong>
        </div>
        <% if(cpn!='0'){ %>
        
        <% }else{%>
          <div class="input-group mt-3 mb-4">
            <form action="/api/aplaycoupon" method="post">
              <input type="text" class="form-control border" name="cpn" placeholder="Promo code" required />
              <% if(status==false){ %>
                <p style="color: red; width: 100%;text-align: center;">Invalid coupon!</p>
                <% } %>
            <button type="submit" class="btn btn-light text-primary border">Apply</button>
            </form>
            
          </div>
          <% } %>
        
        
      </div>
    </div>
  </div>
</div>
</div>
<!-- Modal -->
<div class="modal fade" id="orderSuccessModal" tabindex="-1" role="dialog" aria-labelledby="orderSuccessModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="orderSuccessModalLabel">Order Placed Successfully</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Your order has been placed successfully. Thank you for shopping with us!
      </div>
        <div class="modal-footer">
          <a href="/api/order?payment=COD" class="btn btn-primary">Close</a>
        </div>
    </div>
  </div>
</div>
<script>
  $("#checkout-form").submit((e) => {
    e.preventDefault();
    $.ajax({
      url: `/submit-order`,
      method: 'post',
      data: $('#checkout-form').serialize(),
      success: (response) => {
        if (response.url) {
          return window.location.href = response.url;
        }
        razorpayPayment(response);
      },
    });
  });
  function razorpayPayment(order) {
    var options = {
      "key": "rzp_test_0uyYQwL3E1zyEp",
      "amount":order.amount,
      "currency": "INR",
      "name": "infinity",
      "description": "Test Transaction",
      "image": "",
      "order_id": order.razorpay_order_id,
      "handler": function (response) {
        alert('Payment successful. Payment ID: ' + response.razorpay_payment_id);
        window.location.href = '/api/order?payment=AOD';
        
      },
      "prefill": {
        "name": "",
        "email": "",
        "contact": "9000090000"
      },
      "notes": {
        "address": "Razorpay Corporate Office"
      },
      "theme": {
        "color": "#232F3E;"
      }
    };
    var rzp = new Razorpay(options);
    rzp.open();
  }
  var codbtn=document.getElementById("cod-btn")
  codbtn.addEventListener('click',()=>{
    document.getElementById('cod').style.display='block'
    document.querySelector('.cc').style.display='none'
    document.getElementById('wallet').style.display='none'
  })
  var wallet=document.getElementById("wallet-btn")
  wallet.addEventListener('click',()=>{
    document.getElementById('wallet').style.display='block'
    document.querySelector('.cc').style.display='none'
    document.getElementById('cod').style.display='none'
  })
  var ccbtn=document.getElementById("cc-btn")
  ccbtn.addEventListener('click',()=>{
    document.querySelector('.cc').style.display='block'
    document.getElementById('wallet').style.display='none'
    document.getElementById('cod').style.display='none'
  })
</script>

<script>
// Add an event listener to the button
document.getElementById('rzp-button').addEventListener('click', function () {
    // Trigger Razorpay modal
    startRazorpayPayment();
});
</script>

<!-- Add this script tag in the head section of your HTML file -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>


<!-- include footer -->
<%- include('include/_footer') %>
<!-- /include footer -->

<!-- Remove the container if you want to extend the Footer to full width. -->
